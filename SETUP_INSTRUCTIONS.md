# Инструкции по настройке оптимизации маршрутов

## Вариант 1: Быстрое исправление (main.py)

### Изменения в существующем коде:
1. **Исправлен парсинг ответа computeRouteMatrix API**
2. **Улучшена обработка ошибок**
3. **Добавлены лучшие параметры для OR-Tools**
4. **Увеличена надежность решения TSP**

### Для использования:
```bash
# Установите зависимости (если еще не установлены)
pip install -r requirements.txt

# Установите переменные окружения
export GOOGLE_MAPS_API_KEY="ваш_api_ключ"
export SECRET_KEY="ваш_секретный_ключ"

# Запустите приложение
python main.py
```

### Что исправлено:
- ✅ Корректный парсинг ответа API
- ✅ Лучшие параметры оптимизации для OR-Tools
- ✅ Улучшенная обработка ошибок
- ✅ Подробный вывод отладочной информации
- ✅ Возврат в исходную точку для TSP

---

## Вариант 2: Современный подход (main_route_optimization.py)

### Преимущества:
1. **Один API вызов** вместо трех
2. **Более точная оптимизация** с учетом реальных дорожных условий
3. **Лучшая производительность**
4. **Профессиональное решение** от Google

### Установка и настройка:

#### 1. Установите зависимости:
```bash
pip install -r requirements_route_optimization.txt
```

#### 2. Настройте Google Cloud:

##### Вариант A: Сервисный аккаунт (рекомендуется)
```bash
# Создайте сервисный аккаунт в Google Cloud Console
# Скачайте JSON ключ и установите переменную окружения
export GOOGLE_APPLICATION_CREDENTIALS="/path/to/your/service-account-key.json"
export GOOGLE_CLOUD_PROJECT_ID="your-project-id"
```

##### Вариант B: Для Google Cloud Platform
```bash
# Если запускаете на GCP, просто установите Project ID
export GOOGLE_CLOUD_PROJECT_ID="your-project-id"
```

#### 3. Включите API:
В Google Cloud Console включите:
- Route Optimization API
- Maps Platform APIs

#### 4. Запустите приложение:
```bash
python main_route_optimization.py
```

---

## Сравнение подходов:

| Характеристика | Вариант 1 (Исправленный) | Вариант 2 (Route Optimization) |
|---|---|---|
| **Количество API вызовов** | 3 | 1 |
| **Точность оптимизации** | Хорошая | Отличная |
| **Скорость** | Средняя | Быстрая |
| **Простота настройки** | Простая | Средняя |
| **Стоимость** | Средняя | Может быть выше |
| **Надежность** | Хорошая | Отличная |

---

## Рекомендации:

### Для быстрого исправления:
- Используйте **Вариант 1**, если нужно быстро исправить существующий код
- Подходит для небольших объемов запросов

### Для продакшена:
- Используйте **Вариант 2** для серьезных приложений
- Лучше подходит для масштабирования
- Более точные результаты оптимизации

---

## Отладка:

### Проверка API ключей:
```bash
# Проверьте переменные окружения
echo $GOOGLE_MAPS_API_KEY
echo $GOOGLE_CLOUD_PROJECT_ID
```

### Логи:
Оба варианта включают подробные DEBUG логи для отладки проблем.

### Частые ошибки:
1. **Неверный API ключ** - проверьте права доступа
2. **Неправильный Project ID** - убедитесь, что проект существует
3. **Не включены API** - активируйте нужные сервисы в Google Cloud Console

---

## Тестирование:

### Пример JSON для тестирования:
```json
{
  "addresses": [
    "Moscow, Russia",
    "Saint Petersburg, Russia", 
    "Kazan, Russia",
    "Nizhny Novgorod, Russia",
    "Samara, Russia"
  ]
}
```

Сохраните в файл `test_addresses.json` и загрузите через веб-интерфейс. 